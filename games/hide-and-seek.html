<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hide and Seek - Escape the Monster!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        
        .icon {
            width: 1.5rem;
            height: 1.5rem;
            display: inline-block;
            vertical-align: middle;
        }
        
        .room-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }
        
        .room-button {
            min-height: 100px;
            position: relative;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 4px solid;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .room-button:not(:disabled):hover {
            transform: scale(1.05);
        }
        
        .room-button:disabled {
            cursor: default;
        }
        
        .room-name {
            color: white;
            font-weight: bold;
            margin-bottom: 0.25rem;
            font-size: 0.75rem;
            text-align: center;
        }
        
        .room-icons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .room-move-indicator {
            color: #86efac;
            margin-top: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: none;
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-black flex items-center justify-center p-4">
        <div class="max-w-5xl w-full">
            <!-- Header -->
            <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                <h1 class="text-4xl font-bold text-white flex items-center gap-3">
                    <span class="icon">üëª</span>
                    Hide and Seek
                </h1>
                
                <div class="flex gap-3">
                    <div class="bg-gray-800 px-4 py-2 rounded-lg flex items-center gap-2">
                        <span class="icon">üèÜ</span>
                        <div>
                            <div class="text-purple-400 text-xl font-bold" id="level-display">Level 1</div>
                            <div class="text-gray-400 text-xs" id="difficulty-display">Easy</div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 px-4 py-2 rounded-lg flex items-center gap-2" id="key-status" style="display: none;">
                        <span class="icon" id="key-icon">üîë</span>
                        <span class="text-sm font-bold" id="key-text">Find Key</span>
                    </div>
                    
                    <div class="bg-gray-800 px-4 py-2 rounded-lg flex items-center gap-2" id="timer-display" style="display: none;">
                        <span class="icon">‚è∞</span>
                        <div class="text-yellow-400 text-2xl font-bold" id="timer-text">45s</div>
                    </div>
                </div>
            </div>
            
            <!-- Game Status -->
            <div class="bg-gray-800 rounded-xl p-4 mb-4">
                <div id="game-status-text" class="text-center">
                    <p class="text-white text-lg mb-2">
                        üè† Level 1: Find the <span class="text-yellow-400 font-bold">KEY</span> in the <span class="text-yellow-400 font-bold">Boiler Room</span> and escape!
                    </p>
                    <p class="text-gray-300 text-sm mb-2">
                        Time Limit: 45s | Monster Speed: Easy
                    </p>
                    <p class="text-red-400 text-sm">
                        ‚ö†Ô∏è Monster starts at Back Stairs. Get 4 moves before it wakes up!
                    </p>
                </div>
            </div>

            <!-- Game Board -->
            <div class="bg-gray-900 p-4 rounded-xl mb-4">
                <div class="room-grid" id="game-board">
                    <!-- Rooms will be dynamically generated here -->
                </div>
            </div>

            <!-- Controls -->
            <div class="flex gap-4 justify-center" id="game-controls">
                <button id="start-btn" class="px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold text-lg transition-all">
                    Start Level 1
                </button>
            </div>

            <!-- Legend -->
            <div class="mt-3 text-center" id="game-legend" style="display: none;">
                <div class="inline-flex gap-4 bg-gray-800 px-4 py-2 rounded-lg flex-wrap justify-center">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-blue-600 rounded"></div>
                        <span class="text-white text-xs">You</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-purple-600 rounded"></div>
                        <span class="text-white text-xs">Monster</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-green-700 rounded"></div>
                        <span class="text-white text-xs">Can Move</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="icon">üîë</span>
                        <span class="text-white text-xs">Key</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="icon">üè†</span>
                        <span class="text-white text-xs">Exit</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game data and configuration
        const ROOMS = [
            // Ground Floor
            { id: 0, name: 'Front Door', x: 2, y: 0, connections: [1], isExit: true },
            { id: 1, name: 'Foyer', x: 2, y: 1, connections: [0, 2, 4] },
            { id: 2, name: 'Living Room', x: 1, y: 1, connections: [1, 3, 5] },
            { id: 3, name: 'Library', x: 0, y: 1, connections: [2, 6] },
            { id: 4, name: 'Dining Room', x: 3, y: 1, connections: [1, 7] },
            { id: 5, name: 'Kitchen', x: 1, y: 2, connections: [2, 6, 8] },
            { id: 6, name: 'Pantry', x: 0, y: 2, connections: [3, 5, 9] },
            { id: 7, name: 'Hallway', x: 3, y: 2, connections: [4, 8, 10] },
            { id: 8, name: 'Bathroom', x: 2, y: 2, connections: [5, 7, 11] },
            
            // Basement
            { id: 9, name: 'Basement Stairs', x: 0, y: 3, connections: [6, 12] },
            { id: 10, name: 'Back Stairs', x: 3, y: 3, connections: [7, 13] },
            { id: 11, name: 'Laundry Room', x: 2, y: 3, connections: [8, 12, 13] },
            { id: 12, name: 'Basement', x: 1, y: 3, connections: [9, 11, 14] },
            { id: 13, name: 'Storage', x: 3, y: 4, connections: [10, 11, 15] },
            { id: 14, name: 'Boiler Room', x: 0, y: 4, connections: [12, 15] },
            { id: 15, name: 'Wine Cellar', x: 3, y: 5, connections: [13, 14] },
        ];

        const LEVEL_CONFIGS = [
            { level: 1, keyRoom: 6, monsterSpeed: 1800, timeLimit: 90, description: 'Tutorial' },      // Very easy start
            { level: 2, keyRoom: 9, monsterSpeed: 1500, timeLimit: 75, description: 'Beginner' },     // Still easy 
            { level: 3, keyRoom: 12, monsterSpeed: 1200, timeLimit: 60, description: 'Easy' },        // Getting comfortable
            { level: 4, keyRoom: 14, monsterSpeed: 1000, timeLimit: 50, description: 'Normal' },      // Original easy
            { level: 5, keyRoom: 13, monsterSpeed: 850, timeLimit: 45, description: 'Medium' },       // Slightly harder
            { level: 6, keyRoom: 11, monsterSpeed: 700, timeLimit: 40, description: 'Hard' },         // Original medium
            { level: 7, keyRoom: 15, monsterSpeed: 600, timeLimit: 35, description: 'Very Hard' },    // Original hard
            { level: 8, keyRoom: 14, monsterSpeed: 500, timeLimit: 30, description: 'Expert' },       // Original expert
        ];

        // Game state
        let gameState = 'ready'; // ready, playing, won, lost, winner
        let currentLevel = 1;
        let playerRoom = 1;
        let monsterRoom = 10;
        let timeLeft = LEVEL_CONFIGS[0].timeLimit;
        let hasKey = false;
        let keyCollected = false;
        let roomsMoved = 0;
        let monsterActive = false;
        let totalTime = 0;
        let lostOnLevel = 1;
        let intervalRef = null;
        let timerRef = null;

        function getCurrentConfig() {
            return LEVEL_CONFIGS[currentLevel - 1] || LEVEL_CONFIGS[LEVEL_CONFIGS.length - 1];
        }

        function getWakeUpThreshold() {
            // Give beginners more free moves before monster wakes up
            if (currentLevel <= 2) return 4;      // Tutorial/Beginner: 4 free moves
            if (currentLevel <= 4) return 3;      // Easy/Normal: 3 free moves  
            if (currentLevel <= 6) return 2;      // Medium/Hard: 2 free moves
            return 1;                              // Very Hard/Expert: 1 free move
        }

        function getRandomMonsterSpawn() {
            const currentConfig = getCurrentConfig();
            const excludedRooms = [0, 1, currentConfig.keyRoom];
            const availableRooms = ROOMS.filter(r => !excludedRooms.includes(r.id)).map(r => r.id);
            return availableRooms[Math.floor(Math.random() * availableRooms.length)];
        }

        function updateDisplay() {
            const currentConfig = getCurrentConfig();
            
            // Update level display
            document.getElementById('level-display').textContent = `Level ${currentLevel}`;
            document.getElementById('difficulty-display').textContent = currentConfig.description;
            
            // Update timer
            if (gameState === 'playing') {
                document.getElementById('timer-display').style.display = 'flex';
                document.getElementById('timer-text').textContent = `${timeLeft}s`;
            } else {
                document.getElementById('timer-display').style.display = 'none';
            }
            
            // Update key status
            if (gameState === 'playing') {
                document.getElementById('key-status').style.display = 'flex';
                const keyIcon = document.getElementById('key-icon');
                const keyText = document.getElementById('key-text');
                if (hasKey) {
                    keyIcon.className = 'icon text-yellow-400';
                    keyText.className = 'text-sm font-bold text-yellow-400';
                    keyText.textContent = 'KEY!';
                } else {
                    keyIcon.className = 'icon text-gray-600';
                    keyText.className = 'text-sm font-bold text-gray-400';
                    keyText.textContent = 'Find Key';
                }
            } else {
                document.getElementById('key-status').style.display = 'none';
            }
            
            // Update game status text
            updateGameStatusText();
            
            // Show/hide legend
            document.getElementById('game-legend').style.display = gameState === 'playing' ? 'block' : 'none';
        }

        function updateGameStatusText() {
            const statusDiv = document.getElementById('game-status-text');
            const currentConfig = getCurrentConfig();
            
            if (gameState === 'ready') {
                const keyRoomName = ROOMS.find(r => r.id === currentConfig.keyRoom)?.name;
                statusDiv.innerHTML = `
                    <p class="text-white text-lg mb-2">
                        üè† Level ${currentLevel}: Find the <span class="text-yellow-400 font-bold">KEY</span> in the <span class="text-yellow-400 font-bold">${keyRoomName}</span> and escape!
                    </p>
                    <p class="text-gray-300 text-sm mb-2">
                        Time Limit: ${currentConfig.timeLimit}s | Monster Speed: ${currentConfig.description}
                    </p>
                    <p class="text-red-400 text-sm">
                        ‚ö†Ô∏è Monster starts at ${currentLevel >= 3 ? 'RANDOM LOCATION' : 'Back Stairs'}. Get ${currentLevel <= 2 ? '4' : currentLevel <= 4 ? '3' : currentLevel <= 6 ? '2' : '1'} moves before it wakes up!
                    </p>
                `;
            } else if (gameState === 'playing') {
                const playerRoomName = ROOMS.find(r => r.id === playerRoom)?.name;
                const monsterRoomName = ROOMS.find(r => r.id === monsterRoom)?.name;
                const keyRoomName = ROOMS.find(r => r.id === currentConfig.keyRoom)?.name;
                
                let html = `<p class="text-white text-lg">You're in the <span class="text-blue-400 font-bold">${playerRoomName}</span></p>`;
                
                if (!monsterActive) {
                    const wakeUpThreshold = getWakeUpThreshold();
                    html += `<p class="text-green-400 text-sm mt-1 animate-pulse">üò¥ Monster is sleeping... Move ${wakeUpThreshold} rooms to wake it! (${wakeUpThreshold - roomsMoved} more)</p>`;
                } else {
                    html += `<p class="text-purple-400 text-sm mt-1">üëª Monster is in the ${monsterRoomName}!</p>`;
                }
                
                if (!hasKey) {
                    html += `<p class="text-yellow-400 text-sm mt-1 animate-pulse">Find the key in the ${keyRoomName}! üîë</p>`;
                } else {
                    html += `<p class="text-green-400 text-sm mt-1 animate-pulse">Key found! Escape through the Front Door! üèÉ</p>`;
                }
                
                statusDiv.innerHTML = html;
            } else if (gameState === 'won') {
                let html = `
                    <div class="text-center">
                        <div class="text-6xl mb-3 animate-bounce">üèÜ</div>
                        <p class="text-green-400 text-3xl font-bold mb-2">üéâ Level ${currentLevel - 1} Complete! üéâ</p>
                        <p class="text-white text-lg mb-2">You escaped with ${timeLeft} seconds remaining!</p>
                `;
                
                if (currentLevel <= LEVEL_CONFIGS.length) {
                    html += `<p class="text-purple-400 text-sm">Ready for Level ${currentLevel}? It gets harder! üòà</p>`;
                } else {
                    html += `<p class="text-yellow-400 text-lg font-bold">üèÜ YOU'VE BEATEN ALL LEVELS! MASTER! üèÜ</p>`;
                }
                
                html += `</div>`;
                statusDiv.innerHTML = html;
            } else if (gameState === 'winner') {
                statusDiv.innerHTML = `
                    <div class="text-center">
                        <div class="mb-4">
                            <div class="text-6xl mb-3 animate-bounce">üèÜ</div>
                            <div class="flex justify-center gap-2 mb-3">
                                <span class="text-2xl animate-pulse">üèÖ</span>
                                <span class="text-2xl animate-pulse">üèÜ</span>
                                <span class="text-2xl animate-pulse">üèÖ</span>
                            </div>
                        </div>
                        <p class="text-yellow-400 text-4xl font-bold mb-3 animate-pulse">üèÜ CHAMPION! üèÜ</p>
                        <p class="text-green-400 text-2xl font-bold mb-2">YOU DEFEATED ALL 8 LEVELS!</p>
                        <div class="bg-gray-700 rounded-lg p-4 mt-4 inline-block">
                            <p class="text-white text-lg mb-2">üìä Final Stats</p>
                            <div class="text-left space-y-1">
                                <p class="text-gray-300">‚úÖ Levels Completed: <span class="text-green-400 font-bold">8/8</span></p>
                                <p class="text-gray-300">‚è±Ô∏è Total Time Saved: <span class="text-yellow-400 font-bold">${totalTime}s</span></p>
                                <p class="text-gray-300">üéØ Difficulty: <span class="text-red-400 font-bold">EXPERT</span></p>
                            </div>
                        </div>
                        <p class="text-purple-400 text-lg mt-4 font-bold">You are the ultimate Hide and Seek Master! üëë</p>
                    </div>
                `;
            } else if (gameState === 'lost') {
                statusDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-6xl mb-3 animate-pulse">üíÄ</div>
                        <p class="text-red-400 text-3xl font-bold mb-2">üíÄ Game Over! üíÄ</p>
                        <p class="text-white text-lg mb-2">
                            ${playerRoom === monsterRoom ? 'üî¥ The monster caught you!' : '‚è∞ Time ran out!'}
                        </p>
                        <div class="bg-gray-700 rounded-lg p-4 mt-3 inline-block">
                            <p class="text-red-300 text-lg">Failed on Level ${lostOnLevel}</p>
                            <p class="text-yellow-400 text-sm mt-2 animate-pulse">‚ö†Ô∏è Restarting from Level 1!</p>
                        </div>
                        <p class="text-gray-400 text-sm mt-3">One mistake = start over. Can you handle the pressure?</p>
                    </div>
                `;
            }
        }

        function renderBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            ROOMS.forEach(room => {
                const button = document.createElement('button');
                button.className = 'room-button';
                button.style.gridColumn = room.x + 1;
                button.style.gridRow = room.y + 1;
                
                const hasPlayer = playerRoom === room.id;
                const hasMonster = monsterRoom === room.id;
                const hasKeyInRoom = room.id === getCurrentConfig().keyRoom && !keyCollected;
                const isConnected = gameState === 'playing' && 
                    ROOMS.find(r => r.id === playerRoom)?.connections.includes(room.id);
                
                let bgColor = 'bg-gray-700';
                let borderColor = 'border-gray-600';
                
                if (hasPlayer && hasMonster) {
                    bgColor = 'bg-red-600';
                    borderColor = 'border-red-400';
                } else if (hasPlayer) {
                    bgColor = 'bg-blue-600';
                    borderColor = 'border-blue-400';
                } else if (hasMonster) {
                    bgColor = 'bg-purple-600';
                    borderColor = 'border-purple-400';
                } else if (room.isExit) {
                    bgColor = hasKey ? 'bg-green-800' : 'bg-gray-800';
                    borderColor = hasKey ? 'border-green-500' : 'border-red-500';
                } else if (isConnected) {
                    bgColor = 'bg-green-700 hover:bg-green-600';
                    borderColor = 'border-green-500';
                }
                
                const canMove = isConnected && !hasPlayer;
                
                button.className += ` ${bgColor} ${borderColor}`;
                if (!canMove) {
                    button.disabled = true;
                } else {
                    button.onclick = () => moveToRoom(room.id);
                }
                
                button.innerHTML = `
                    <div class="room-name">${room.name}</div>
                    <div class="room-icons">
                        ${hasPlayer ? '<span class="icon text-white">üßë</span>' : ''}
                        ${hasMonster ? '<span class="icon text-white animate-pulse">üëª</span>' : ''}
                        ${hasKeyInRoom && !hasPlayer ? '<span class="icon text-yellow-400 animate-bounce">üîë</span>' : ''}
                        ${room.isExit && !hasPlayer ? `<span class="icon ${hasKey ? 'text-green-400' : 'text-red-400'}">üè†</span>` : ''}
                    </div>
                    ${isConnected && !hasPlayer ? '<div class="room-move-indicator">‚Üí</div>' : ''}
                `;
                
                board.appendChild(button);
            });
        }

        function startGame() {
            const currentConfig = getCurrentConfig();
            const spawnRoom = currentLevel >= 3 ? getRandomMonsterSpawn() : 10;
            
            gameState = 'playing';
            playerRoom = 1;
            monsterRoom = spawnRoom;
            timeLeft = currentConfig.timeLimit;
            hasKey = false;
            keyCollected = false;
            roomsMoved = 0;
            monsterActive = false;
            
            updateDisplay();
            renderBoard();
            updateControls();
            
            // Start timer
            timerRef = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerRef);
                    clearInterval(intervalRef);
                    lostOnLevel = currentLevel;
                    currentLevel = 1;
                    totalTime = 0;
                    gameState = 'lost';
                    updateDisplay();
                    updateControls();
                }
            }, 1000);
        }

        function moveToRoom(roomId) {
            if (gameState !== 'playing') return;
            
            const targetRoom = ROOMS.find(r => r.id === roomId);
            const currentConfig = getCurrentConfig();
            
            if (targetRoom?.isExit) {
                if (hasKey) {
                    clearInterval(intervalRef);
                    clearInterval(timerRef);
                    
                    totalTime += timeLeft;
                    
                    if (currentLevel < LEVEL_CONFIGS.length) {
                        currentLevel++;
                        gameState = 'won';
                    } else {
                        gameState = 'winner';
                    }
                    updateDisplay();
                    updateControls();
                } else {
                    playerRoom = roomId;
                    roomsMoved++;
                    const wakeUpThreshold = getWakeUpThreshold();
                    if (roomsMoved >= wakeUpThreshold && !monsterActive) {
                        monsterActive = true;
                        startMonsterMovement();
                    }
                }
            } else {
                playerRoom = roomId;
                roomsMoved++;
                const wakeUpThreshold = getWakeUpThreshold();
                if (roomsMoved >= wakeUpThreshold && !monsterActive) {
                    monsterActive = true;
                    startMonsterMovement();
                }
            }
            
            // Check if player collected key
            if (playerRoom === currentConfig.keyRoom && !keyCollected) {
                hasKey = true;
                keyCollected = true;
            }
            
            // Check if monster caught player
            if (playerRoom === monsterRoom) {
                clearInterval(intervalRef);
                clearInterval(timerRef);
                lostOnLevel = currentLevel;
                currentLevel = 1;
                totalTime = 0;
                gameState = 'lost';
                updateDisplay();
                updateControls();
                return;
            }
            
            updateDisplay();
            renderBoard();
        }

        function startMonsterMovement() {
            const currentConfig = getCurrentConfig();
            
            intervalRef = setInterval(() => {
                const currentRoom = ROOMS.find(r => r.id === monsterRoom);
                const possibleMoves = currentRoom.connections;
                const playerRoomData = ROOMS.find(r => r.id === playerRoom);
                const monsterRoomData = ROOMS.find(r => r.id === monsterRoom);
                
                // Calculate distance to player
                const distanceToPlayer = Math.abs(monsterRoomData.x - playerRoomData.x) + 
                                       Math.abs(monsterRoomData.y - playerRoomData.y);
                
                // Difficulty-based AI behavior
                let smartChance = 0.5; // Base intelligence
                let trapDistance = 3;   // Distance to start trapping
                
                if (currentLevel <= 2) {
                    // Tutorial/Beginner: Very dumb monster
                    smartChance = 0.3;
                    trapDistance = 2; // Only trap when very close
                } else if (currentLevel <= 4) {
                    // Easy/Normal: Moderate intelligence
                    smartChance = 0.5;
                    trapDistance = 3;
                } else if (currentLevel <= 6) {
                    // Medium/Hard: Smart monster
                    smartChance = 0.7;
                    trapDistance = 4;
                } else {
                    // Very Hard/Expert: Genius monster
                    smartChance = 0.9;
                    trapDistance = 5;
                }
                
                // Smart trapping logic when close (scaled by difficulty)
                if (distanceToPlayer <= trapDistance) {
                    const playerEscapeRooms = playerRoomData.connections;
                    
                    const movesWithScore = possibleMoves.map(roomId => {
                        const room = ROOMS.find(r => r.id === roomId);
                        const distToPlayer = Math.abs(room.x - playerRoomData.x) + 
                                           Math.abs(room.y - playerRoomData.y);
                        
                        let blockScore = 0;
                        playerEscapeRooms.forEach(escapeRoom => {
                            const escapeRoomData = ROOMS.find(r => r.id === escapeRoom);
                            const distToEscape = Math.abs(room.x - escapeRoomData.x) + 
                                               Math.abs(room.y - escapeRoomData.y);
                            if (distToEscape <= 1) blockScore += 3;
                            else if (distToEscape === 2) blockScore += 1;
                        });
                        
                        return { roomId, score: blockScore * 2 - distToPlayer };
                    });
                    
                    if (Math.random() < smartChance) {
                        movesWithScore.sort((a, b) => b.score - a.score);
                        monsterRoom = movesWithScore[0].roomId;
                    } else {
                        monsterRoom = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    }
                } else {
                    // Normal hunting behavior (also scaled by difficulty)
                    const movesWithDistance = possibleMoves.map(roomId => {
                        const room = ROOMS.find(r => r.id === roomId);
                        const distance = Math.abs(room.x - playerRoomData.x) + 
                                        Math.abs(room.y - playerRoomData.y);
                        return { roomId, distance };
                    });
                    
                    // Hunting intelligence also scales with level
                    if (Math.random() < smartChance) {
                        movesWithDistance.sort((a, b) => a.distance - b.distance);
                        monsterRoom = movesWithDistance[0].roomId;
                    } else {
                        monsterRoom = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    }
                }
                
                // Check if monster caught player
                if (playerRoom === monsterRoom) {
                    clearInterval(intervalRef);
                    clearInterval(timerRef);
                    lostOnLevel = currentLevel;
                    currentLevel = 1;
                    totalTime = 0;
                    gameState = 'lost';
                    updateDisplay();
                    updateControls();
                    return;
                }
                
                updateDisplay();
                renderBoard();
            }, currentConfig.monsterSpeed);
        }

        function nextLevel() {
            startGame();
        }

        function resetGame() {
            gameState = 'ready';
            currentLevel = 1;
            playerRoom = 1;
            monsterRoom = 10;
            timeLeft = LEVEL_CONFIGS[0].timeLimit;
            hasKey = false;
            keyCollected = false;
            roomsMoved = 0;
            monsterActive = false;
            totalTime = 0;
            lostOnLevel = 1;
            
            clearInterval(intervalRef);
            clearInterval(timerRef);
            
            updateDisplay();
            renderBoard();
            updateControls();
        }

        function updateControls() {
            const controlsDiv = document.getElementById('game-controls');
            
            if (gameState === 'ready') {
                controlsDiv.innerHTML = `
                    <button id="start-btn" class="px-8 py-4 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold text-lg transition-all">
                        Start Level ${currentLevel}
                    </button>
                `;
                document.getElementById('start-btn').onclick = startGame;
            } else if (gameState === 'won' && currentLevel <= LEVEL_CONFIGS.length) {
                controlsDiv.innerHTML = `
                    <button id="next-btn" class="px-8 py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold text-lg transition-all">
                        Next Level ‚Üí
                    </button>
                    <button id="reset-btn" class="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold text-lg transition-all">
                        Restart Game
                    </button>
                `;
                document.getElementById('next-btn').onclick = nextLevel;
                document.getElementById('reset-btn').onclick = resetGame;
            } else if (gameState === 'won' || gameState === 'lost' || gameState === 'winner') {
                const buttonText = gameState === 'winner' ? 'üèÜ Play Again' : 
                                  gameState === 'lost' ? '‚Üª Start from Level 1' : 'Restart Game';
                controlsDiv.innerHTML = `
                    <button id="reset-btn" class="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold text-lg transition-all">
                        ${buttonText}
                    </button>
                `;
                document.getElementById('reset-btn').onclick = resetGame;
            } else {
                controlsDiv.innerHTML = '';
            }
        }

        // Initialize the game
        updateDisplay();
        renderBoard();
        updateControls();
    </script>
</body>
</html>